@model List<WebBanGiay.Models.OrderDetail>
@{
    ViewBag.Title = "Lịch sử mua hàng";
    Layout = "~/Areas/NhanVienBanHang/Views/Shared/_Layout_NVBH.cshtml";
    var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
}

<div class="container" style="max-width: 1100px; margin: 0 auto;">
    <h2 class="mb-4 text-center" style="font-weight: bold; color: #2d3748; letter-spacing: 1px;">Lịch sử mua hàng của khách hàng</h2>

    @if (customer != null)
    {
        <div class="mb-4 p-3 rounded shadow-sm" style="background: #f8fafc; border: 1px solid #e2e8f0;">
            <span style="font-size: 1.1em;"><strong>Tên khách hàng:</strong> @customer.FullName</span><br />
            <span style="font-size: 1.1em;"><strong>Số điện thoại:</strong> @customer.Phone</span><br />
            <span style="font-size: 1.1em;"><strong>Địa chỉ:</strong> @customer.Address</span>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table table-bordered table-hover" style="background: #fff; border-radius: 12px; overflow: hidden;">
                <thead style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: #fff;">
                    <tr style="text-align: center;">
                        <th>Ngày đặt</th>
                        <th>Mã đơn hàng</th>
                        <th>Trạng thái</th>
                        <th>Sản phẩm</th>
                        <th>Kích thước</th>
                        <th>Màu sắc</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var detail in Model)
                    {
                        <tr style="text-align: center; vertical-align: middle;">
                            <td>@(detail.Order?.OrderDate?.ToString("dd/MM/yyyy HH:mm") ?? "N/A")</td>
                            <td>@detail.Order?.OrderNumber</td>
                            <td>
                                <span class="badge badge-@GetStatusColor(detail.Order?.Status)">
                                    @detail.Order?.Status
                                </span>
                            </td>
                            <td>@detail.ProductVariant?.Product?.ProductName</td>
                            <td>@detail.ProductVariant?.Size?.SizeName</td>
                            <td>@detail.ProductVariant?.Color?.ColorName</td>
                            <td>@detail.Quantity</td>
                            <td>@detail.UnitPrice.ToString("N0") VNĐ</td>
                            <td>@detail.TotalPrice.ToString("N0") VNĐ</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center mt-4">Khách hàng này chưa có lịch sử mua hàng.</div>
    }
</div>

@functions {
    public string GetStatusColor(string status)
    {
        if (string.IsNullOrEmpty(status)) return "secondary";
        switch (status.ToLower())
        {
            case "completed":
            case "hoàn thành":
                return "success";
            case "processing":
            case "đang xử lý":
                return "warning";
            case "cancelled":
            case "đã hủy":
                return "danger";
            default:
                return "secondary";
        }
    }
}

<style>
    .table thead th {
        vertical-align: middle;
        font-size: 1.05em;
        letter-spacing: 0.5px;
    }
    .table td, .table th {
        vertical-align: middle;
        font-size: 1em;
    }
    .badge-success {
        background-color: #38a169;
        color: #fff;
        font-weight: 500;
        padding: 0.4em 0.8em;
        border-radius: 8px;
    }
    .badge-warning {
        background-color: #ecc94b;
        color: #333;
        font-weight: 500;
        padding: 0.4em 0.8em;
        border-radius: 8px;
    }
    .badge-danger {
        background-color: #e53e3e;
        color: #fff;
        font-weight: 500;
        padding: 0.4em 0.8em;
        border-radius: 8px;
    }
    .badge-secondary {
        background-color: #a0aec0;
        color: #fff;
        font-weight: 500;
        padding: 0.4em 0.8em;
        border-radius: 8px;
    }
    @@media (max-width: 768px) {
        .table-responsive {
            font-size: 0.95em;
        }
        .mb-4, .mb-3 {
            margin-bottom: 1rem !important;
        }
    }
</style>

