@model IEnumerable<WebBanGiay.Models.ProductCombo>
@{
    ViewBag.Title = "Danh sách combo sản phẩm";
    Layout = "~/Areas/NhanVienBanHang/Views/Shared/_Layout_NVBH.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-boxes me-2"></i>Danh sách combo sản phẩm
                    </h3>
                    <div class="d-flex gap-2">
                        <a href="@Url.Action("Create")" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>Tạo combo mới
                        </a>
                    </div>
    </div>
                <div class="card-body">

                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tên combo</th>
                                    <th>Mô tả</th>
                                    <th>Giá combo</th>
                                    <th>Ngày bắt đầu</th>
                                    <th>Ngày kết thúc</th>
                                    <th>Thời gian</th>
                                    <th>Trạng thái</th>
                                    <th class="text-center">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                                    var isExpired = item.endDate.HasValue && item.endDate.Value < DateTime.Now;
                                    var isActive = item.IsActive && !isExpired;
                                    var daysLeft = item.endDate.HasValue ? (item.endDate.Value - DateTime.Now).Days : 0;
                                    var totalDays = item.startDate.HasValue && item.endDate.HasValue ? 
                                        (item.endDate.Value - item.startDate.Value).Days : 0;
                                    
                                    <tr>
                                        <td>
                                            <span class="fw-bold text-primary">@item.ComboName</span>
                                        </td>
                                        <td>
                                            <span class="text-muted">@(string.IsNullOrEmpty(item.Description) ? "Không có mô tả" : item.Description)</span>
                                        </td>
                                        <td>
                                            <span class="text-success fw-bold">@item.ComboPrice.ToString("N0") VNĐ</span>
                                        </td>
                                        <td>
                                            @if (item.startDate.HasValue)
                                            {
                                                <small class="text-muted">@item.startDate.Value.ToString("dd/MM/yyyy")</small>
                                            }
                                            else
                                            {
                                                <span class="text-muted fst-italic">Chưa có</span>
                                            }
                                        </td>
                                        <td>
                                            @if (item.endDate.HasValue)
                                            {
                                                <small class="text-muted">@item.endDate.Value.ToString("dd/MM/yyyy")</small>
                                            }
                                            else
                                            {
                                                <span class="text-muted fst-italic">Chưa có</span>
                                            }
                                        </td>
                                        <td>
                                            @if (totalDays > 0)
                                            {
                                                if (totalDays > 30)
                                                {
                                                    <span class="badge bg-danger" title="Vượt quá 30 ngày">@totalDays ngày</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-success">@totalDays ngày</span>
                                                }
                                            }
                                            else
                                            {
                                                <span class="text-muted fst-italic">Chưa xác định</span>
                                            }
                                        </td>
                                        <td>
                                            @if (isActive)
                                            {
                                                <span class="badge bg-success">Hoạt động</span>
                                            }
                                            else if (isExpired)
                                            {
                                                <span class="badge bg-danger">Hết hạn</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">Không hoạt động</span>
                                            }
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <a href="@Url.Action("Details", new { id = item.ComboID })" 
                                                   class="btn btn-sm btn-outline-info" 
                                                   title="Chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                @if (!isExpired)
                                                {
                                                    <a href="@Url.Action("Edit", new { id = item.ComboID })" 
                                                       class="btn btn-sm btn-outline-warning" 
                                                       title="Sửa">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                }
                                                <a href="@Url.Action("Delete", new { id = item.ComboID })" 
                                                   class="btn btn-sm btn-outline-danger" 
                                                   title="Xóa">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
                    </div>

                    <div class="alert alert-warning mt-4">
                        <h6 class="alert-heading">
                            <i class="fas fa-exclamation-triangle me-2"></i>Lưu ý quan trọng:
                        </h6>
                        <ul class="mb-0 small">
                            <li><strong>Combo có thời gian > 30 ngày sẽ được đánh dấu màu đỏ</strong></li>
                            <li>Chỉ được chỉnh sửa combo chưa hết hạn</li>
                            <li>Đảm bảo tất cả sản phẩm trong combo đều còn hàng</li>
                            <li>Kiểm tra tồn kho trước khi thực hiện combo</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
