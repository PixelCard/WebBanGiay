
@{
    ViewBag.Title = "Checkoutpage";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .breadcrumb__text h2 {
        color: #333333 !important;
        text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
    }

    .breadcrumb__option {
        color: #555555 !important;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
    }

        .breadcrumb__option a {
            color: #333333 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .breadcrumb__option span {
            color: #555555 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

    /* Payment Method Dropdown Styling */
    .checkout__order .form-group {
        margin-bottom: 15px !important;
        width: 100% !important;
    }

        .checkout__order .form-group label {
            display: block !important;
            margin-bottom: 8px !important;
            font-size: 14px !important;
            color: #333 !important;
            font-weight: 600 !important;
        }

        .checkout__order .form-group select {
            width: 100% !important;
            max-width: 100% !important;
            padding: 10px 12px !important;
            border: 1px solid #ddd !important;
            border-radius: 4px !important;
            font-size: 14px !important;
            background-color: #fff !important;
            transition: border-color 0.3s ease !important;
            box-sizing: border-box !important;
        }

            .checkout__order .form-group select:focus {
                outline: none !important;
                border-color: #7fad39 !important;
                box-shadow: 0 0 0 2px rgba(127, 173, 57, 0.2) !important;
            }

        .checkout__order .form-group input[type="checkbox"] {
            margin-right: 10px !important;
            transform: scale(1.2) !important;
        }

            .checkout__order .form-group input[type="checkbox"] + label {
                display: inline !important;
                margin-bottom: 0 !important;
                cursor: pointer !important;
                font-weight: 500 !important;
            }

    /* Responsive design for payment options */
    @@media (max-width: 768px) {
        .checkout__order .form-group {
            margin-bottom: 12px !important;
        }

            .checkout__order .form-group label {
                font-size: 13px !important;
            }

            .checkout__order .form-group select {
                padding: 8px 10px !important;
                font-size: 13px !important;
            }
    }
</style>

<!-- Page Preloder -->
<div id="preloder">
    <div class="loader"></div>
</div>

<!-- Humberger Begin -->
<div class="humberger__menu__overlay"></div>
<div class="humberger__menu__wrapper">
    <div class="humberger__menu__logo">
        <a href="@Url.Action("Index", "Home")"><img src="~/Content/img/logo.png" alt=""></a>
    </div>
    <div class="humberger__menu__cart">
        <ul>
            <li><a href="#"><i class="fa fa-heart"></i> <span>1</span></a></li>
            <li><a href="@Url.Action("ShoppingCartPage", "ShoppingCart")"><i class="fa fa-shopping-bag"></i> <span>@(Session["Cart"] != null ? ((List<WebBanGiay.Models.model_class.CartItem>)Session["Cart"]).Count : 0)</span></a></li>
        </ul>
        <div class="header__cart__price">item: <span>@(Session["Cart"] != null ? ((List<WebBanGiay.Models.model_class.CartItem>)Session["Cart"]).Sum(item => item.TotalPrice).ToString("N0") + " VNĐ" : "0 VNĐ")</span></div>
    </div>
    <div class="humberger__menu__widget">
        <div class="header__top__right__language">
            <img src="~/Content/img/language.png" alt="">
            <div>English</div>
            <span class="arrow_carrot-down"></span>
            <ul>
                <li><a href="#">Spanis</a></li>
                <li><a href="#">English</a></li>
            </ul>
        </div>
        <div class="header__top__right__auth">
            @if (Session["Email"] != null)
            {
                <a href="@Url.Action("LoginPage", "Account")"><i class="fa fa-user"></i> @Session["Email"]</a>
                <a href="@Url.Action("Logout", "Account")" style="margin-left: 10px;"><i class="fa fa-sign-out"></i> Đăng xuất</a>
            }
            else
            {
                <a href="@Url.Action("LoginPage", "Account")"><i class="fa fa-user"></i> Đăng nhập</a>
            }
        </div>
    </div>
    <nav class="humberger__menu__nav mobile-menu">
        <ul>
            <li><a href="@Url.Action("Index", "Home")">Trang chủ</a></li>
            <li><a href="#">Cửa hàng</a></li>
            <li>
                <a href="#">Trang</a>
                <ul class="header__menu__dropdown">
                    <li><a href="@Url.Action("ShoppingCartPage", "ShoppingCart")">Giỏ hàng</a></li>
                    <li><a href="@Url.Action("Checkoutpage", "CheckOut")">Thanh toán</a></li>
                    @if (Session["Email"] != null)
                    {
                        <li><a href="@Url.Action("AccountDetails", "Account")">Thông tin tài khoản</a></li>
                        <li><a href="@Url.Action("Logout", "Account")">Đăng xuất</a></li>
                    }
                    else
                    {
                        <li><a href="@Url.Action("LoginPage", "Account")">Đăng nhập</a></li>
                        <li><a href="@Url.Action("Register", "Account")">Đăng ký</a></li>
                    }
                </ul>
            </li>
            <li><a href="#">Blog</a></li>
            <li><a href="#">Liên hệ</a></li>
        </ul>
    </nav>
    <div id="mobile-menu-wrap"></div>
    <div class="header__top__right__social">
        <a href="#"><i class="fa fa-facebook"></i></a>
        <a href="#"><i class="fa fa-twitter"></i></a>
        <a href="#"><i class="fa fa-linkedin"></i></a>
        <a href="#"><i class="fa fa-pinterest-p"></i></a>
    </div>
    <div class="humberger__menu__contact">
        <ul>
            <li><i class="fa fa-envelope"></i> hello@colorlib.com</li>
            <li>Free Shipping for all Order of $99</li>
        </ul>
    </div>
</div>
<!-- Humberger End -->
<!-- Header Section Begin -->
<header class="header">
    <div class="header__top">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <div class="header__top__left">
                        <ul>
                            <li><i class="fa fa-envelope"></i> hello@colorlib.com</li>
                            <li>Free Shipping for all Order of $99</li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="header__top__right">
                        <div class="header__top__right__social">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-linkedin"></i></a>
                            <a href="#"><i class="fa fa-pinterest-p"></i></a>
                        </div>
                        <div class="header__top__right__language">
                            <img src="~/Content/img/language.png" alt="">
                            <div>English</div>
                            <span class="arrow_carrot-down"></span>
                            <ul>
                                <li><a href="#">Spanis</a></li>
                                <li><a href="#">English</a></li>
                            </ul>
                        </div>
                        <div class="header__top__right__auth">
                            @if (Session["Email"] != null)
                            {
                                <a href="@Url.Action("LoginPage", "Account")"><i class="fa fa-user"></i> @Session["Email"]</a>
                                <a href="@Url.Action("Logout", "Account")" style="margin-left: 10px;"><i class="fa fa-sign-out"></i> Đăng xuất</a>
                            }
                            else
                            {
                                <a href="@Url.Action("LoginPage", "Account")"><i class="fa fa-user"></i> Đăng nhập</a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="header__logo">
                    <a href="@Url.Action("Index", "Home")"><img src="~/Content/img/logo.png" alt=""></a>
                </div>
            </div>
            <div class="col-lg-6">
                <nav class="header__menu">
                    <ul>
                        <li><a href="@Url.Action("Index", "Home")">Trang chủ</a></li>
                        <li><a href="#">Cửa hàng</a></li>
                        <li>
                            <a href="#">Trang</a>
                            <ul class="header__menu__dropdown">
                                <li><a href="@Url.Action("ShoppingCartPage", "ShoppingCart")">Giỏ hàng</a></li>
                                <li><a href="@Url.Action("Checkoutpage", "CheckOut")">Thanh toán</a></li>
                                @if (Session["Email"] != null)
                                {
                                    <li><a href="@Url.Action("AccountDetails", "Account")">Thông tin tài khoản</a></li>
                                    <li><a href="@Url.Action("Logout", "Account")">Đăng xuất</a></li>
                                }
                                else
                                {
                                    <li><a href="@Url.Action("LoginPage", "Account")">Đăng nhập</a></li>
                                    <li><a href="@Url.Action("Register", "Account")">Đăng ký</a></li>
                                }
                            </ul>
                        </li>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Liên hệ</a></li>
                    </ul>
                </nav>
            </div>
            <div class="col-lg-3">
                <div class="header__cart">
                    <ul>
                        <li><a href="#"><i class="fa fa-heart"></i> <span>1</span></a></li>
                        <li><a href="@Url.Action("ShoppingCartPage", "ShoppingCart")"><i class="fa fa-shopping-bag"></i> <span>@(Session["Cart"] != null ? ((List<WebBanGiay.Models.model_class.CartItem>)Session["Cart"]).Count : 0)</span></a></li>
                    </ul>
                    <div class="header__cart__price">item: <span>@(Session["Cart"] != null ? ((List<WebBanGiay.Models.model_class.CartItem>)Session["Cart"]).Sum(item => item.TotalPrice).ToString("N0") + " VNĐ" : "0 VNĐ")</span></div>
                </div>
            </div>
        </div>
        <div class="humberger__open">
            <i class="fa fa-bars"></i>
        </div>
    </div>
</header>
<!-- Header Section End -->

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="/Content/img/breadcrumb.jpg?v=@DateTime.Now.Ticks">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Checkout</h2>
                    <div class="breadcrumb__option">
                        <a href="./index.html">Home</a>
                        <span>Checkout</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- Checkout Section Begin -->
<section class="checkout spad">
    <div class="container">
        <div class="checkout__form">
            <h4>Billing Details</h4>
            @using (Html.BeginForm("Checkoutpage", "CheckOut", FormMethod.Post))
            {
                <div class="row">
                    <div class="col-lg-8 col-md-6">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>First Name<span>*</span></p>
                                    @if (ViewBag.IsLoggedIn && ViewBag.Customer != null)
                                    {
                                        var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
                                        var fullName = customer.FullName ?? "";
                                        var firstName = fullName.Split(' ').FirstOrDefault() ?? "";
                                        <input type="text" value="@firstName" readonly style="background-color: #f8f9fa;">
                                    }
                                    else
                                    {
                                        <input type="text" name="firstName" required>
                                    }
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Last Name<span>*</span></p>
                                    @if (ViewBag.IsLoggedIn && ViewBag.Customer != null)
                                    {
                                        var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
                                        var fullName = customer.FullName ?? "";
                                        var nameParts = fullName.Split(' ');
                                        var lastName = nameParts.Length > 1 ? string.Join(" ", nameParts.Skip(1)) : "";
                                        <input type="text" value="@lastName" readonly style="background-color: #f8f9fa;">
                                    }

                                    else
                                    {
                                        <input type="text" name="lastName" required>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="checkout__input">
                            <p>Address<span>*</span></p>
                            @if (ViewBag.IsLoggedIn && ViewBag.Customer != null)
                            {
                                var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
                                <input type="text" value="@(customer.Address ?? "")" name="address" required>
                            }
                            else
                            {
                                <input type="text" placeholder="Street Address" class="checkout__input__add" name="address" required>
                            }
                            <input type="text" placeholder="Apartment, suite, unite ect (optional)" name="address2">
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Phone<span>*</span></p>
                                    @if (ViewBag.IsLoggedIn && ViewBag.Customer != null)
                                    {
                                        var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
                                        <input type="text" value="@(customer.Phone ?? "")" name="phone" required>
                                    }

                                    else
                                    {
                                        <input type="text" name="phone" required>
                                    }
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Email<span>*</span></p>
                                    @if (ViewBag.IsLoggedIn && ViewBag.Customer != null)
                                    {
                                        var customer = ViewBag.Customer as WebBanGiay.Models.Customer;
                                        <input type="email" value="@(customer.Account?.Email ?? "")" name="email" required>
                                    }

                                    else
                                    {
                                        <input type="email" name="email" required>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="checkout__input">
                            <p>Order notes<span>*</span></p>
                            <input type="text" name="orderNotes"
                                   placeholder="Notes about your order, e.g. special notes for delivery.">
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="checkout__order">
                            <h4>Your Order</h4>
                            <div class="checkout__order__products">Products <span>Total</span></div>
                            <ul>
                                @{
                                    var cart = ViewBag.Cart as List<WebBanGiay.Models.model_class.CartItem>;
                                    if (cart != null && cart.Any())
                                    {
                                        foreach (var item in cart)
                                        {
                                            <li style="display:block">
                                                @item.ProductName
                                                <small style="color: #666; font-size: 12px;">
                                                    Màu: @item.ColorName | Size: @item.SizeName | Qty: @item.Quantity
                                                </small>
                                                <span>@item.TotalPrice.ToString("N0") VNĐ</span>
                                            </li>
                                        }
                                    }
                                    else
                                    {
                                        <li>No items in cart</li>
                                    }
                                }
                            </ul>
                            <div class="checkout__order__subtotal">Subtotal <span id="checkout-subtotal">@ViewBag.CartTotal.ToString("N0") VNĐ</span></div>
                            <div class="checkout__order__shipping" id="shipping-fee-row" style="display:none; margin-bottom:20px">
                                Shipping Fee <span id="shipping-fee">25,000 VNĐ</span>
                            </div>
                            <div class="form-group">
                                <label for="paymentMethod">Phương thức thanh toán</label>
                                <select id="paymentMethod" name="paymentMethod">
                                    <option value="cod">Thanh toán khi nhận hàng (COD)</option>
                                    <option value="bank">Chuyển khoản ngân hàng</option>
                                    <option value="momo">Ví MoMo</option>
                                    <option value="zalopay">Ví ZaloPay</option>
                                </select>
                            </div>

                            <div class="form-group" style="display:inline-block;margin-top:20px">
                                <input type="checkbox" id="shipping" name="shipping">
                                <label for="shipping">Tôi muốn giao hàng tận nơi</label>
                            </div>


                            <div class="checkout__order__total mt-4">Total <span id="checkout-total">@ViewBag.CartTotal.ToString("N0") VNĐ</span></div>

                            <button type="submit" class="site-btn">PLACE ORDER</button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
<!-- Checkout Section End -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var shippingCheckbox = document.getElementById('shipping');
        var totalSpan = document.getElementById('checkout-total');
        var subtotalSpan = document.getElementById('checkout-subtotal');
        var shippingFeeRow = document.getElementById('shipping-fee-row');
        var baseTotal = parseFloat(totalSpan.innerText.replace(/[^\d]/g, ''));
        var shippingFee = 25000;

        function updateTotal() {
            if (shippingCheckbox.checked) {
                totalSpan.innerText = (baseTotal + shippingFee).toLocaleString('vi-VN') + ' VNĐ';
                shippingFeeRow.style.display = '';
            } else {
                totalSpan.innerText = baseTotal.toLocaleString('vi-VN') + ' VNĐ';
                shippingFeeRow.style.display = 'none';
            }
        }

        if (shippingCheckbox) {
            shippingCheckbox.addEventListener('change', updateTotal);
        }
    });
</script>